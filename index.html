<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JS Bin</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <canvas id="test" op-canvas-bike width="1000" height="1000"></canvas>

  <div id="controls" op-bike-controls></div>

  <div id="debug"></div>
  <script src="debug.js"></script>
  <script src="bike.js"></script>
  <script src="canvas-bike.js"></script>
  <script type="text/javascript">
    (function() {
      var bike = new CanvasBike(document.querySelector('canvas'))
        , controls = document.querySelector('#controls');

      bike.setRearWheelFloorPosition({ x: 101, y: 427 });
      bike.update();

      var image = new Image()
        , imageLoaded = false
        , imageWidth = 500
        , imageHeight;

      image.onload = function() {
        imageLoaded = true;
        var scale = image.width / imageWidth;
        imageHeight = image.height / scale;
      };
      image.src = "http://www.bikequarterly.com/images/Geometry750.jpg";

      var i = 0
        , pedalPoints = 180
        , pedalAngleDelta = Math.PI * 2 / pedalPoints
        , pedalAngle = 0;

      var intervalID = setInterval(function() {
        if (i == pedalPoints) {
          i = 0;
        }

        bike.setPedalAngle(pedalAngle);

        pedalAngle += pedalAngleDelta;
        i += 1;
      }, 1000 / 60);

      var editables = [
        { name: 'Front Wheel Radius', owner: bike.frontWheel, property: 'radius', min: 1, max: 200 },
        { name: 'Rear Wheel Radius', owner: bike.rearWheel, property: 'radius', min: 1, max: 200 },
        { name: 'Bottom Bracket Drop', owner: bike.bottomBracket, property: 'drop', min: 0, max: 200 },
        { name: 'Seat Tube Length', owner: bike.seatTube, property: 'length', min: 1, max: 200 },
        { name: 'Seat Tube Angle', owner: bike.seatTube, property: 'angle', min: 0, max: 360 },
        { name: 'Chain Stay Length', owner: bike.chainStay, property: 'length', min: 1, max: 200 },
        { name: 'Head Tube Length', owner: bike.headTube, property: 'length', min: 1, max: 200 },
        { name: 'Head Tube Angle', owner: bike.headTube, property: 'angle', min: 0, max: 360 },
        { name: 'Stack', owner: bike, property: 'stack', min: 1, max: 200 },
        { name: 'Reach', owner: bike, property: 'reach', min: 1, max: 200 },
        { name: 'Rake', owner: bike, property: 'rake', min: 0, max: 200 },

        { name: 'Upper Leg Length', owner: bike, property: 'upperLegLength', min: 1, max: 200 },
        { name: 'Lower Leg Length', owner: bike, property: 'lowerLegLength', min: 1, max: 200 }
      ];

      editables.forEach(function(editable) {
        var wrapper = document.createElement('div')
          , label = document.createElement('label')
          , el = document.createElement('input')
          , id = editable.name.toLowerCase().replace(' ', '-');

        wrapper.classList.add('control');
        label.setAttribute('for', id);
        label.innerText = editable.name;

        el.setAttribute('id', id);
        el.setAttribute('type', 'range');
        el.setAttribute('min', editable.min);
        el.setAttribute('max', editable.max);
        el.value = editable.owner[editable.property];

        wrapper.appendChild(label);
        wrapper.appendChild(el);
        controls.appendChild(wrapper);

        el.addEventListener('input', function() {
          editable.owner[editable.property] = parseInt(el.value, 10);
          bike.update();
        });
      });
    })();
  </script>
</body>
</html>